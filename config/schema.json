{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Synthetic Data Generation Input Specification",
  "type": "object",
  "required": ["metadata", "tables"],
  "properties": {
    "metadata": {
      "type": "object",
      "required": ["project_name", "row_counts", "random_seed", "output_format"],
      "properties": {
        "project_name": { "type": "string" },
        "description": { "type": "string" },
        "version": { "type": "string" },
        "default_locale": { "type": "string", "description": "Default locale for Faker data generation (e.g., 'en_US', 'fr_FR')." },
        "random_seed": { "type": "integer" },
        "output_format": { "type": "string", "enum": ["csv", "json", "parquet", "sql"] },
        "row_counts": {
          "type": "object",
          "patternProperties": {
            "^[a-zA-Z_][a-zA-Z0-9_]*$": { "type": "integer", "minimum": 1 }
          }
        }
      }
    },
    "tables": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "columns"],
        "properties": {
          "name": { "type": "string" },
          "columns": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["name", "type"],
              "properties": {
                "name": { "type": "string" },
                "type": {
                  "type": "string",
                  "enum": ["string", "integer", "float", "boolean", "date"]
                },
                "nullable": { "type": "boolean" },
                "is_primary_key": { "type": "boolean" },
                "is_unique": { "type": "boolean" },
                "foreign_key": {
                  "type": "object",
                  "required": ["table", "column"],
                  "properties": {
                    "table": { "type": "string" },
                    "column": { "type": "string" },
                    "on_delete": { "type": "string", "enum": ["cascade", "restrict", "set_null"] }
                  }
                },
                "derived": {
                  "type": "object",
                  "required": ["formula"],
                  "properties": { "formula": { "type": "string" } }
                },
                "distribution": {
                  "type": "object",
                  "required": ["type"],
                  "properties": {
                    "type": {
                      "type": "string",
                      "enum": [
                        "normal", "uniform", "categorical", "sequential",
                        "fixed_percentage", "custom_format", "conditional", "name", "date"
                      ]
                    },
                    "locale": { "type": "string", "description": "Locale for Faker data generation for this column (e.g., 'en_US', 'fr_FR'). Overrides default_locale." },
                    "mean": { "type": "number" },
                    "stddev": { "type": "number" },
                    "min": { "type": ["number", "string"] },
                    "max": { "type": ["number", "string"] },
                    "start": { "type": ["number", "string"] },
                    "end": { "type": ["number", "string"] },
                    "values": { "type": "array", "items": { "type": "string" } },
                    "probabilities": { "type": "array", "items": { "type": "number" } },
                    "pattern": { "type": "string" },
                    "percentage": { "type": "number" },
                    "of_column": { "type": "string" },
                    "conditional_on": { "type": "object" },
                    "conditions": { "type": "object" }
                  }
                }
              }
            }
          },
          "constraints": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["type"],
              "properties": {
                "type": {
                  "type": "string",
                  "enum": [
                    "value_range", "categorical", "regex", "nullability",
                    "functional_dependency", "foreign_key", "derived_field",
                    "conditional", "inter_table_dependency"
                  ]
                },
                "column": { "type": "string" },
                "min": { "type": "number" },
                "max": { "type": "number" },
                "formula": { "type": "string" },
                "expression": { "type": "string" },
                "from_column": { "type": "string" },
                "to_table": { "type": "string" },
                "to_column": { "type": "string" }
              }
            }
          }
        }
      }
    }
  }
}
